2025-12-12

# 5分間負荷テスト結果レポート

## テスト概要

- **期間**: 5分間（300秒）
- **コンテンツ配置**: 
  - node1: 10個のコンテンツ（/content1_1.txt ～ /content1_10.txt）
  - node2: 10個のコンテンツ（/content2_1.txt ～ /content2_10.txt）
- **トラフィック生成**: 
  - node3, node4からランダムに/relay経由でコンテンツを取得
  - 0.5秒間隔でリクエストを送信
- **測定項目**:
  1. 各ルータからの/relayのコストの推移（10秒間隔）
  2. トラフィックの分散度

## テスト結果

### 1. コスト推移

#### コスト推移表（10秒間隔）

| 時間(s) | node3->node1 | node3->node2 | node4->node1 | node4->node2 |
|---------|--------------|--------------|--------------|--------------|
| 0       | 25000        | 50000        | 50000        | 25000        |
| 10      | 25000        | 50000        | 50000        | 25000        |
| 20      | 25000        | 50000        | 50000        | 25000        |
| 30      | 25000        | 50000        | 50000        | 25000        |
| 40      | 25000        | 50000        | 50000        | 25000        |
| 50      | 25000        | 50000        | 50000        | 25000        |
| 60      | 25000        | 50000        | 50000        | 25000        |
| 70      | 25000        | 50000        | 50000        | 25000        |
| 80      | 25000        | 50000        | 50000        | 25000        |
| 90      | 25000        | 50000        | 50000        | 25000        |
| 100     | 25000        | 50000        | 50000        | 25000        |
| 110     | 25000        | 50000        | 50000        | 25000        |
| 120     | 25000        | 50000        | 50000        | 25000        |
| 130     | 25000        | 50000        | 50000        | 25000        |
| 140     | 25000        | 50000        | 50000        | 25000        |
| 150     | 25000        | 50000        | 50000        | 25000        |
| 160     | 25000        | 50000        | 50000        | 25000        |
| 170     | 25000        | 50000        | 50000        | 25000        |
| 180     | 25000        | 50000        | 50000        | 25000        |
| 190     | 25000        | 50000        | 50000        | 25000        |
| 200     | 25000        | 50000        | 50000        | 25000        |
| 210     | 25000        | 50000        | 50000        | 25000        |
| 220     | 25000        | 50000        | 50000        | 25000        |
| 230     | 25000        | 50000        | 50000        | 25000        |
| 240     | 25000        | 50000        | 50000        | 25000        |
| 250     | 25000        | 50000        | 50000        | 25000        |
| 260     | 25000        | 50000        | 50000        | 25000        |
| 270     | 25000        | 50000        | 50000        | 25000        |
| 280     | 25000        | 50000        | 50000        | 25000        |
| 290     | 25000        | 50000        | 50000        | 25000        |
| 300     | 25000        | 50000        | 50000        | 25000        |

#### コスト統計

- **node3->node1**: min=25000, max=25000, avg=25000, 変化=0
- **node3->node2**: min=50000, max=50000, avg=50000, 変化=0
- **node4->node1**: min=50000, max=50000, avg=50000, 変化=0
- **node4->node2**: min=25000, max=25000, avg=25000, 変化=0

**分析:**
- **node3->node1**: コスト = `25000`（元のコストのみ、FunctionCost = 0）
- **node3->node2**: コスト = `50000`（元のコスト25000 + FunctionCost 25000）
- **node4->node1**: コスト = `50000`（元のコスト25000 + FunctionCost 25000）
- **node4->node2**: コスト = `25000`（元のコストのみ、FunctionCost = 0）
- **コストはテスト期間中、一定値を維持（変化なし）**

### 2. トラフィック分散度

#### サイドカーログ解析結果

- **Node1**: 0 リクエスト（0.0%）
- **Node2**: 3 リクエスト（100.0%）
- **分散度**: 0.0%

#### 時間ごとの分散

| 時刻 | node1 | node2 |
|------|-------|-------|
| 2025-12-17 14:53:54 | 0 | 1 |
| 2025-12-17 14:56:30 | 0 | 1 |
| 2025-12-17 14:57:17 | 0 | 1 |

**分析:**
- テスト期間中、node2にのみトラフィックが集中
- node1にはトラフィックが到達していない
- これは、node3, node4からnode2へのコストが低いため、node2が選択されている可能性がある
- **トラフィックが少ない**: 5分間で3リクエストのみ（期待値より少ない）
- **リクエスト間隔**: 約2-3分間隔でリクエストが発生

### 3. コストの動的変化

**観察:**
- コストはテスト期間中、一定の値を維持
- FunctionCostが動的に変化していない可能性がある

**考えられる原因:**
1. トラフィックが少なく、FunctionCostが計算されていない
2. サイドカーログの更新が反映されていない
3. NameLSAの更新が行われていない

## 分析と考察

### コストの固定値について

コストが固定されている理由:
1. **トラフィックが少ない**: テスト期間中、node2にのみ3リクエストが記録されている
2. **FunctionCostの計算タイミング**: FunctionCostはサイドカーログの更新に基づいて計算されるが、ログの更新頻度が低い可能性がある
3. **NameLSAの更新頻度**: NameLSAの更新が5秒間隔で行われているが、実際のログ更新がそれより遅い可能性がある

### トラフィック分散について

トラフィックがnode2に集中している理由:
1. **コストの差**: node3, node4からnode2へのコストが低い（25000）
2. **ルーティング選択**: NFDが低コストのパスを選択するため、node2が優先される
3. **負荷分散の効果**: FunctionCostが適用されていないため、負荷分散が機能していない

## 改善提案

1. **トラフィック生成の強化**: より多くのトラフィックを生成して、FunctionCostの動的変化を観察
2. **ログ更新頻度の確認**: サイドカーログの更新頻度を確認し、必要に応じて調整
3. **NameLSA更新の確認**: NameLSAの更新が正しく行われているか確認

## まとめ

### 測定結果

1. **コスト推移**: 
   - テスト期間中、コストは固定値を維持
   - node3->node1: 25000（FunctionCost = 0）
   - node3->node2: 50000（FunctionCost = 25000）
   - node4->node1: 50000（FunctionCost = 25000）
   - node4->node2: 25000（FunctionCost = 0）

2. **トラフィック分散**: 
   - node2にのみトラフィックが集中（分散度: 0.0%）
   - node1にはトラフィックが到達していない
   - 5分間で3リクエストのみ（期待値より少ない）

3. **FunctionCostの動的変化**: 
   - 観察されなかった
   - トラフィックが少ないため、FunctionCostが更新されていない可能性がある

### 考察

- **コストの固定**: トラフィックが少ないため、FunctionCostが計算されていない、または更新されていない
- **トラフィック集中**: 低コストのパス（node2）が選択され続けている
- **負荷分散の効果**: トラフィックが少ないため、負荷分散の効果が観察されていない

### 今後の改善点

1. **トラフィック生成の強化**: より多くのトラフィックを生成して、FunctionCostの動的変化を観察
2. **ログ更新頻度の確認**: サイドカーログの更新頻度を確認し、必要に応じて調整
3. **NameLSA更新の確認**: NameLSAの更新が正しく行われているか確認

